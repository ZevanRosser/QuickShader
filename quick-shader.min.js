/*QuickShader v0.1.0 */
!function(){var a=0,b=0;document.addEventListener("mousemove",function(c){a=c.pageX,b=c.pageY});var c="attribute vec2 pos;void main(){gl_Position=vec4(pos.x,pos.y,0.0,1.00);}",d=["#ifdef GL_ES\n","precision highp float;\n","#endif\n","uniform bool mouseDown;\n","uniform bool mouseUp;\n","uniform bool mouseClicked;\n","uniform vec3 resolution;\n","uniform float time;\n","uniform float millis;\n","uniform vec2 mouse;\n","uniform sampler2D tex0;\n"].join("");window.QuickShader=function(a){a.shader||console.warn("You must specify a fragment shader"),this.width=a.width||400,this.height=a.height||400,this.shader=a.shader,this.textureCode="",this.texturesIn=a.textures||[],this.textures=[],this.inputCode="",this.inputs=a.inputs||[],this.canvas=document.createElement("canvas"),this.canvas.width=this.width,this.canvas.height=this.height,this.addCanvasMouseEvents(),a.parentNode&&(this.parentNode="object"==typeof a.parentNode?a.parentNode:document.querySelector(a.parentNode),this.parentNode.appendChild(this.canvas)),this.pauseOffset=0,this.totalPauseTime=0,this.init()},QuickShader.prototype={constructor:QuickShader,init:function(){var a,b,c;if(a=this.gl=this.ctx=this.canvas.getContext("experimental-webgl"),b=new Float32Array([-1,-1,1,-1,-1,1,1,-1,1,1,-1,1]),this.quadVBO=a.createBuffer(),a.bindBuffer(a.ARRAY_BUFFER,this.quadVBO),a.bufferData(a.ARRAY_BUFFER,b,a.STATIC_DRAW),this.texturesIn.forEach(this.addTexture.bind(this)),this.inputs.forEach(this.addInput.bind(this)),this.shader=[d,this.textureCode,this.inputCode,this.shader].join(""),c=this.configureShader()){if(this.destroy(),this.parentNode){var e=document.createElement("pre");e.innerHTML=c,this.parentNode.appendChild(e)}}else this.size(this.width,this.height),this.millis=(new Date).getMilliseconds()/1e3},addCanvasMouseEvents:function(){this.mouseDown=!1,this.mouseUp=!1,this.mouseClicked=!1,this.onClick=this.onClick.bind(this),this.onMouseDown=this.onMouseDown.bind(this),this.onMouseUp=this.onMouseUp.bind(this),this.canvas.addEventListener("click",this.onClick),this.canvas.addEventListener("mousedown",this.onMouseDown),document.addEventListener("mouseup",this.onMouseUp)},onClick:function(){this.mouseClicked=!0},onMouseDown:function(){this.mouseDown=!0},onMouseUp:function(){this.mouseUp=!0,this.mouseDown=!1},destroy:function(){this.reset(),this.canvas.removeEventListener("click",this.onClick),this.canvas.removeEventListener("mousedown",this.onMouseDown),document.removeEventListener("mouseup",this.onMouseUp),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas)},reset:function(){this.startTime=null,cancelAnimationFrame(this.animationId)},play:function(){this.error||(this.totalPauseTime+=this.pauseOffset,this.paused=!1,this.startTime||(this.startTime=+new Date,this.run()))},run:function(){var a=(+new Date-this.startTime-this.totalPauseTime)/1e3;this.render(a),this.animationId=requestAnimationFrame(this.run.bind(this))},pause:function(){this.paused=!0,this.pauseTime=+new Date},size:function(a,b){this.width=a,this.height=b,this.canvas.width=a,this.canvas.height=b,this.gl.viewport(0,0,this.width,this.height)},configureShader:function(){var a,b=this.gl,d=b.createProgram(),e=b.createShader(b.VERTEX_SHADER),f=b.createShader(b.FRAGMENT_SHADER);return b.shaderSource(e,c),b.shaderSource(f,this.shader),b.compileShader(e),b.compileShader(f),b.getShaderParameter(f,b.COMPILE_STATUS)?(b.attachShader(d,e),b.attachShader(d,f),b.deleteShader(e),b.deleteShader(f),b.linkProgram(d),this.shaderProgram&&b.deleteProgram(this.shaderProgram),void(this.shaderProgram=d)):(a=b.getShaderInfoLog(f),b.deleteProgram(d),this.error=!0,"shader-error: \n"+a)},render:function(c){var d,e,f=this.gl,g=[],h=this.textures.length;if(c=c||0,this.paused)return void(this.pauseOffset=+new Date-this.pauseTime);f.viewport(0,0,this.width,this.height),f.useProgram(this.shaderProgram),g[0]=f.getAttribLocation(this.shaderProgram,"pos"),g[1]=f.getUniformLocation(this.shaderProgram,"time"),g[2]=f.getUniformLocation(this.shaderProgram,"resolution"),g[3]=f.getUniformLocation(this.shaderProgram,"millis"),g[4]=f.getUniformLocation(this.shaderProgram,"mouse"),g[5]=f.getUniformLocation(this.shaderProgram,"mouseDown"),g[6]=f.getUniformLocation(this.shaderProgram,"mouseUp"),g[7]=f.getUniformLocation(this.shaderProgram,"mouseClicked");for(var i=0;h>i;i++)d=f.getUniformLocation(this.shaderProgram,this.textures[i].name),f.uniform1i(d,i),f.activeTexture(f["TEXTURE"+i]),f.bindTexture(f.TEXTURE_2D,this.textures[i].texture);f.uniform1f(g[1],c),f.uniform3f(g[2],this.width,this.height,1),f.uniform1f(g[3],this.millis),e=this.canvas.getBoundingClientRect(),mouseX=a-e.left,mouseY=b-e.top,f.uniform2f(g[4],mouseX,mouseY),f.uniform1f(g[5],+this.mouseDown),f.uniform1f(g[6],+this.mouseUp),f.uniform1f(g[7],+this.mouseClicked),this.mouseUp=!1,this.mouseClicked=!1,f.bindBuffer(f.ARRAY_BUFFER,this.quadVBO),f.vertexAttribPointer(g[0],2,f.FLOAT,!1,0,0),f.enableVertexAttribArray(g[0]),f.drawArrays(f.TRIANGLES,0,6),f.disableVertexAttribArray(g[0])},addInput:function(a){this.inputCode+=[a.type," ",a.name," = ",a.value,";\n"].join("")},addTexture:function(a){var b=this.gl,c=a.src,d=a.name,e=b.createTexture();this.textureCode+=["uniform sampler2D ",d,";\n"].join(""),b.pixelStorei(b.UNPACK_FLIP_Y_WEBGL,!0),b.bindTexture(b.TEXTURE_2D,e),b.texImage2D(b.TEXTURE_2D,0,b.RGBA,b.RGBA,b.UNSIGNED_BYTE,c),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,b.LINEAR),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,b.LINEAR_MIPMAP_NEAREST),b.generateMipmap(b.TEXTURE_2D),b.bindTexture(b.TEXTURE_2D,null),this.textures.push({name:d,texture:e})}}}();